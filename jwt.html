<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JSON Web Tokens (JWT) :: Red Hat Single Sign-On Workshop</title>
    <link rel="canonical" href="https://olleb.com/rhsso-workshop/jwt.html">
    <link rel="prev" href="vault.html">
    <link rel="next" href="troubleshooting.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="./_/css/site.css">
<link rel="icon" href="./_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="./_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://olleb.com/rhsso-workshop">Red Hat Single Sign-On Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
            <a class="navbar-item" href="https://atarazana.github.io/kitchensink-guide/" target="_blank">Deploying JBoss EAP applications on OpenShift</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">Workshop Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#tools">Workshop Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html#deployrhsso">Deploying Red Hat Single Sign-On on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#deployrhsso-operator">Deploying Red Hat Single Sign-On Using the Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#deployrhsso-templates">Deploying Red Hat Single Sign-On Using Templates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#deploy-ipa">Deploying Identity Management (IdM/FreeIPA)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="secapp.html">Securing Applications and Services</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="secapp.html#realm-config">Configuring Realm, Roles, Groups and Users</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="secapp.html#quarkus-app">Securing Quarkus Applications with OIDC</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="federation.html">User Federation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="federation.html#ldap">LDAP User Federation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="federation.html#user-storage-spi">User Storage SPI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="federation.html#user-storage-spi-jpa">External User Database Store</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="federation.html#user-storage-spi-rest">External User REST Service Store</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="authentication.html">Authentication Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="authentication.html#auth-spi">Authentication SPI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="authentication.html#auth-plugin-setup">Configuring Plugins and Authentication Flows</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="authentication.html#telegram2fa">Two-Factor Authentication with Telegram</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="vault.html">Secrets and Vault Integration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="vault.html#vault-spi">Vault SPI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="vault.html#vault-conjur">Integrating RH-SSO with Conjur using the Vault SPI</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="jwt.html">JSON Web Tokens (JWT)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#custom-claim">Adding a Custom JWT Claim</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="troubleshooting.html">FAQs &amp; Troubleshooting</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting.html#version">Which Keycloak version is this SSO based on?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting.html#extend-image">How to Extend the SSO Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting.html#register-provider">How to Register Provider Implementations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting.html#admin-creds">How to Obtain Admin Credentials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting.html#trace-logging">How to Enable TRACE Logging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Single Sign-On Workshop</a></li>
    <li><a href="jwt.html">JSON Web Tokens (JWT)</a></li>
  </ul>
</nav>
  <div style="padding: 0 0.5rem 0 0.75rem;"><a href="https://olleb.com" target="_blank" rel="noopener noreferrer"> © 2023 - Àngel Ollé Blázquez</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">JSON Web Tokens (JWT)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>JSON Web Token (JWT) is an open standard (RFC 7519) that defines a compact and self-contained way to securely transmit information between parties as a JSON object. JWTs are widely used for authentication and authorization in web applications, APIs, and microservices.</p>
</div>
<div class="paragraph">
<p>A JWT consists of three parts: a <strong>header</strong>, a <strong>payload</strong>, and a <strong>signature</strong>.
The header typically specifies the token type and the signing algorithm. The payload contains the claims - information such as user identity, permissions, or other metadata. The signature ensures the integrity and authenticity of the token, verifying that it has not been altered during transmission.</p>
</div>
<div class="paragraph">
<p>JWTs are a key component in OAuth 2.0 and OpenID Connect (OIDC) flows, where they securely convey user identity and authorization data between the client and the authorization server.</p>
</div>
<div class="paragraph">
<p>One of the main advantages of JWTs is that they are stateless, meaning that the server does not need to store session data. This property makes them ideal for microservices and distributed environments.</p>
</div>
<div class="paragraph">
<p>From a security perspective, JWTs are considered secure when the signature is properly implemented and verified. The signing key - known only to the issuing server - ensures that tokens cannot be tampered with or forged.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom-claim"><a class="anchor" href="#custom-claim"></a>Adding a Custom JWT Claim</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the application has been secured using OIDC (see section <a href="#secapp-oidc">2.1.2 - Securing Quarkus web applications using OpenID Connect (OIDC)</a>), we may need to include a custom claim in the JWT token based on a user attribute. This allows us to use that attribute for fine-grained authorization in the application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Red Hat Single Sign-On administration console in a web browser.</p>
</li>
<li>
<p>Navigate to <code>Clients</code> → select the <code>quarkus-petclinic</code> client in the <code>Demo</code> realm.</p>
</li>
<li>
<p>Click on the <code>Mappers</code> tab and click <code>Create</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jwt/mapper1.png" alt="mapper1">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the mapper:</p>
<div class="ulist">
<ul>
<li>
<p>Mapper Type: <code>User attribute</code></p>
</li>
<li>
<p>User Attribute: the attribute you want to map (for example, <code>admin</code>)</p>
</li>
<li>
<p>Token Claim Name: choose the claim name for the JSON payload</p>
</li>
<li>
<p>Claim JSON Type: select the data type (for example, <code>boolean</code>)</p>
</li>
<li>
<p>Add to ID token: <code>ON</code> if you want it included in the ID token</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once completed, click <code>Save</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jwt/mapper2.png" alt="mapper2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the attribute to a test user:</p>
<div class="ulist">
<ul>
<li>
<p>Navigate to <code>Users</code> → <code>View all users</code> → select the user <code>angel</code>.</p>
</li>
<li>
<p>Click on the <code>Attributes</code> tab.</p>
</li>
<li>
<p>Fill in the <code>admin</code> field (or other attribute), click <code>Add</code>, then click <code>Save</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jwt/edit-user.png" alt="edit user">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jwt/new-user-attr.png" alt="new user attr">
</div>
</div>
<div class="paragraph">
<p>Verifying the Claim</p>
</div>
<div class="paragraph">
<p>After logging in to the application with an authorized user, the custom claim should now be present in the JWT. You can inspect it from the Quarkus application by injecting the <code>JsonWebToken</code> via CDI, or using any valid JWT inspection method.</p>
</div>
<div class="listingblock lines_space console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">eyJhbGciOiJS...xmRqTndw</code></pre>
</div>
</div>
<div class="paragraph">
<p>Decoding the JWT should reveal the new attribute:</p>
</div>
<div class="listingblock lines_space console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">{
  "alg": "RS256",
  ...
}
{
  ...
  "azp": "quarkus-petclinic",
  ...
  "realm_access": {
    "roles": [
      "vet"
    ]
  },
  ...
  "admin": true,
  "preferred_username": "angel"
}
{
  ...
}</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="vault.html">Secrets and Vault Integration</a></span>
  <span class="next"><a href="troubleshooting.html">FAQs &amp; Troubleshooting</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="./_/js/vendor/clipboard.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
</html>
