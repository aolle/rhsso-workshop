<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JSON Web Tokens (JWT) :: Red Hat Single Sign-On Workshop</title>
    <link rel="canonical" href="https://olleb.com/rhsso-workshop/jwt.html">
    <link rel="prev" href="vault.html">
    <link rel="next" href="troubleshooting.html">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="./_/css/site.css">
<link rel="icon" href="./_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="./_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://olleb.com/rhsso-workshop">Red Hat Single Sign-On Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kafka-tutorial/" target="_blank">Kafka</a>
            <a class="navbar-item" href="https://devsecops-workshop.github.io/" target="_blank">DevSecOps</a>
            <a class="navbar-item" href="https://acidonper.github.io/redhat-workshop-cicd-gitops/redhat-workshop-cicd-gitops/" target="_blank">CI/CD & GitOps</a>
            <a class="navbar-item" href="https://atarazana.github.io/gramola-gitops-guide/gramola-gitops-guide/" target="_blank">Gramola GitOps Guide</a>
            <a class="navbar-item" href="https://luisarizmendi.github.io/tutorial-secure-onboarding/" target="_blank">Secure Edge device onboarding with RHEL and FDO</a>
            <a class="navbar-item" href="https://xbryan1.github.io/rhte-2023-acm-docs/" target="_blank">Multicluster Application Deployment with Advanced Cluster Management and GitOps</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/java-inner-loop-dev-guide/java-inner-loop-dev-guide/index.html" target="_blank">Java Inner Loop Dev Guide</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#tools">1.1. Workshop Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html#deployrhsso">1.2. Deploying Red Hat Single Sign-On for OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#deployrhsso-operator">1.2.1 Deploying Red Hat Single Sign-On for OpenShift using the Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="setup.html#deployrhsso-templates">1.2.2 Deploying Red Hat Single Sign-On for OpenShift using the templates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html#deploy-ipa">1.3 Deploying an Identity Management (IdM/FreeIPA) on Red Hat OpenShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">2. Red Hat Single Sign-On</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="secapp.html">2.1 Securing web applications and services with Red Hat Single Sign-On</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="secapp.html#presetup">2.1.1 Configuring the realm, roles, groups and users</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="secapp.html#quarkus-app">2.1.2 Securing Quarkus web applications using OpenID Connect (OIDC)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="federation.html">2.2 User Federation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="federation.html#ldap">2.2.1 LDAP User Federation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="federation.html#user-storage-spi">2.2.2 User Storage SPI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="federation.html#user-storage-spi-jpa">2.2.2.1 External user database store</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="federation.html#user-storage-spi-rest">2.2.2.2 External user REST service store</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="authentication.html">2.3 Authentication</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="authentication.html">2.3.1 Authentication SPI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="authentication.html#presetup">2.3.1.1 Configuring the plugin and flows</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="authentication.html#telegram2fa">2.3.1.2 Telegram two-factor authentication with authentication SPI</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="vault.html">2.4 Vault</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="vault.html">2.4.1 Vault SPI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="vault.html#vault-spi-conjur">2.4.1.1 Integrating Red Hat Single Sign-On with CyberArk Conjur for secrets management</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="jwt.html">2.5 JSON Web Tokens (JWT)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#custom-claim">2.5.1 Adding a custom JWT claim</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="troubleshooting.html">2.4 FAQs &amp; Troubleshooting</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting.html">2.4.1 Which Keycloak version is Red Hat Single Sign-On based on?</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting.html">2.4.2 How to Extend Red Hat Single Sign-On OpenShift Image</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting.html">2.4.3 How to Register Provider Implementations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting.html">2.4.4 How to Obtain the Red Hat Single Sign-On Admin Credentials</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting.html">2.4.5 How to Enable TRACE Logging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Red Hat Single Sign-On Workshop</a></li>
    <li>2. Red Hat Single Sign-On</li>
    <li><a href="jwt.html">2.5 JSON Web Tokens (JWT)</a></li>
  </ul>
</nav>
  <div style="padding: 0 0.5rem 0 0.75rem;"><a href="https://olleb.com" target="_blank" rel="noopener noreferrer"> © 2023 - Àngel Ollé Blázquez</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">JSON Web Tokens (JWT)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>JWT stands for "JSON Web Token", which is an open standard (RFC 7519) for securely transmitting information between parties as a JSON object. It&#8217;s often used for authentication and authorization in web applications, APIs, and microservices.</p>
</div>
<div class="paragraph">
<p>JWTs consist of three parts: a header, a payload, and a signature. The header typically contains metadata about the token, such as the algorithm used for signing the token. The payload contains the actual data being transmitted, such as user information or permissions. The signature is used to verify that the token was not tampered with during transmission.</p>
</div>
<div class="paragraph">
<p>JWTs are commonly used in OAuth 2.0 and OpenID Connect (OIDC) flows, where they are used to securely transmit information about the user and their authorization status between the client and the authorization server.</p>
</div>
<div class="paragraph">
<p>One of the key advantages of JWTs is that they are stateless, meaning that the server doesn&#8217;t need to maintain a session or store the token. This makes JWTs ideal for use in microservices and distributed systems.</p>
</div>
<div class="paragraph">
<p>In terms of security, JWTs are generally considered to be secure as long as the signature is properly implemented and verified. The signature is generated using a secret key that is known only to the issuing server, and is used to verify that the token has not been tampered with during transmission.</p>
</div>
<div class="paragraph">
<p>Note that while this section on JWTs could be included in the context of the section 2.1.2, I decided to create a separate section to specifically address the topic. However, it&#8217;s important to note that the scenarios we&#8217;re starting from are those of a web application that has already been secured using OpenID Connect (OIDC).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom-claim"><a class="anchor" href="#custom-claim"></a>Adding a custom JWT claim</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once we have secured the application using OIDC (see section <code>2.1.2 - Securing Quarkus web applications using OpenID Connect (OIDC)</code>), we may have a need to add a custom claim to the JWT token based on a user attribute, in order to use that attribute for authorization.</p>
</div>
<div class="paragraph">
<p>In this section, we will see how Red Hat Single Sign-On allows us to map user attributes to claims.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open a web browser and log in to the Red Hat Single Sign-On administration console. Navigate to <code>Clients</code> and select the <code>quarkus-petclinic</code> client from our <code>Demo</code> realm. Then, click on the <code>Mappers</code> tab and select the <code>Create</code> button.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jwt/mapper1.png" alt="mapper1">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Fill out the information for the attribute that we want to map to a claim. Under the <code>Mapper Type</code> option, select <code>User attribute</code>. Then, select the data type for the JSON claim.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For our example, we will map the <code>admin</code> attribute, which is a <code>boolean</code>. Once we have completed these steps, click on the <code>Save</code> button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jwt/mapper2.png" alt="mapper2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>After creating the mapper, we need to add the attribute to our test user. Navigate to <code>Users</code> and click on View all users. Select the previously created user, angel, to edit.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We may want the attribute to be added to the ID token. If so, please configure it to "On".
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jwt/edit-user.png" alt="edit user">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to the <code>Attributes</code> tab, fill in the fields and click <code>Add</code>. Then, click on <code>Save</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/jwt/new-user-attr.png" alt="new user attr">
</div>
</div>
<div class="paragraph">
<p>We should now have the new claim present in the JWT. In my case, I will verify this by inspecting its value from the Quarkus petclinic application. I will use CDI to inject the <code>JsonWebToken</code> and then inspect it. Of course, any other valid procedure could be used.</p>
</div>
<div class="paragraph">
<p>After logging in to the application with an authorized user, we can check the JWT.</p>
</div>
<div class="listingblock lines_space console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">eyJhbGciOiJS...xmRqTndw</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we decode the JWT, we can see that the new attribute has been added.</p>
</div>
<div class="listingblock lines_space console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">{
  "alg": "RS256",
  ...
}
{
  ...
  "azp": "quarkus-petclinic",
  ...
  "realm_access": {
    "roles": [
      "vet"
    ]
  },
  ...
  "admin": true,
  "preferred_username": "angel"
}
{
  ...
}</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="vault.html">2.4 Vault</a></span>
  <span class="next"><a href="troubleshooting.html">2.4 FAQs &amp; Troubleshooting</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="./_/js/vendor/clipboard.js"></script>
<script src="./_/js/site.js"></script>
<script async src="./_/js/vendor/highlight.js"></script>
  </body>
</html>
