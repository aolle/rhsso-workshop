Once the application has been secured using OIDC (see section xref:secapp-oidc[2.1.2 - Securing Quarkus web applications using OpenID Connect (OIDC)]), we may need to include a custom claim in the JWT token based on a user attribute. This allows us to use that attribute for fine-grained authorization in the application.

* Open the Red Hat Single Sign-On administration console in a web browser.
* Navigate to `Clients` → select the `quarkus-petclinic` client in the `Demo` realm.
* Click on the `Mappers` tab and click `Create`.

image::jwt/mapper1.png[]

* Configure the mapper:

** Mapper Type: `User attribute`
** User Attribute: the attribute you want to map (for example, `admin`)
** Token Claim Name: choose the claim name for the JSON payload
** Claim JSON Type: select the data type (for example, `boolean`)
** Add to ID token: `ON` if you want it included in the ID token

Once completed, click `Save`.

image::jwt/mapper2.png[]

* Add the attribute to a test user:

** Navigate to `Users` → `View all users` → select the user `angel`.
** Click on the `Attributes` tab.
** Fill in the `admin` field (or other attribute), click `Add`, then click `Save`.

image::jwt/edit-user.png[]
image::jwt/new-user-attr.png[]

Verifying the Claim

After logging in to the application with an authorized user, the custom claim should now be present in the JWT. You can inspect it from the Quarkus application by injecting the `JsonWebToken` via CDI, or using any valid JWT inspection method.

[.lines_space]
[.console-output]
[source,text, subs="+macros,+attributes"]
----
eyJhbGciOiJS...xmRqTndw
----

Decoding the JWT should reveal the new attribute:

[.lines_space]
[.console-output]
[source,text, subs="+macros,+attributes"]
----
{
  "alg": "RS256",
  ...
}
{
  ...
  "azp": "quarkus-petclinic",
  ...
  "realm_access": {
    "roles": [
      "vet"
    ]
  },
  ...
  "admin": true,
  "preferred_username": "angel"
}
{
  ...
}
----
