Red Hat Single Sign-On (RH-SSO) can validate credentials from LDAP or Active Directory. In this section, we will integrate RH-SSO with IdM/FreeIPA.

Creating a user in FreeIPA

* Open the FreeIPA administration web console.
* Create a new user `robert`:
  * Browse to `Identity` → `Users`.
  * Click `Add`.

image::federation/ldap-users-add.png[]

* Fill in the user form:

** User login: `robert`
** First name: `Robert`
** Last name: `Garcia`
** Set a password

image::federation/ldap-add-user.png[]

* Click `Add`.

image::federation/ldap-added-user.png[]

Creating a group in FreeIPA

* Go to `Identity` → `Groups`. Click `Add`.

image::federation/ldap-add-group.png[]

* Add a `Non-POSIX` group named `special_staff`. Click `Add`.

image::federation/ldap-group-add.png[]

image::federation/ldap-groups-list.png[]

* Assign `robert` to the `special_staff` group:
  * Browse to `Identity` → `Users`. Select the user `robert`.

image::federation/ldap-users-list.png[]

  * Click the `User Groups` tab, then `Add`.

image::federation/ldap-user-add-to-group.png[]

  * Select `special_staff` and click `Add`.

image::federation/ldap-added-user-to-group.png[]

image::federation/ldap-user-groups-list.png[]

Configuring LDAP in RH-SSO

* Open the RH-SSO administration web console.
* Select the `Demo` realm.
* Click `User Federation`.

image::federation/sso-user-federation.png[]

* Select `ldap` as the provider.

image::federation/sso-ldap-provider.png[]

* Fill in the required settings for the LDAP provider and click `Save`.

image::federation/sso-ldap-config.png[]

* Click `Synchronize all users`.

NOTE: We are using a plain LDAP connection for this workshop. To use SSL, change the service port to `636` and the protocol to `ldaps`.

NOTE: The `Bind Credential` is the password for the `Directory Manager` account in FreeIPA. This account is created during the FreeIPA installation and has full administrative privileges.

Configuring the group mapper

* Click the `Mappers` tab. Click `Create`.

image::federation/sso-ldap-create-mapper.png[]

* Configure the mapper:

** Name: `group`
** Mapper Type: `group-ldap-mapper`
** Fill in the remaining fields and click `Save`.

image::federation/sso-ldap-mapper-cfg.png[]

* Click `Sync LDAP Groups To Keycloak`.
* Verify that the group has been imported successfully:

image::federation/sso-imported-group.png[]

* Also, check that the user `robert` has been imported:

image::federation/sso-imported-user.png[]
